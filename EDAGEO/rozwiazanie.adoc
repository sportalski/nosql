= Technologie nosql - zaliczenie
Sylwester Portalski <shace209@o2.pl>
:icons: font

W projekcie u¿y³em nastêpuj¹cy sprzêt i technologie:

[format="csv"]
|===
Procesor, Intel(R) Core(TM) XEON X3320 CPU @ 2.75GHz
Pamiêc RAM, 4GB
Dysk, HDD
System operacyjny, Windows 8.1 Professional x64
MongoDB, 3.0.7
PostgreSQL, 9.3.5
Python, 2.7.7
Psycopg2, 2.6.1
JetBrains, 14.03
|===

Podda³em analizie zbiór https://dl.dropboxusercontent.com/u/15056258/mongodb/trades.json[trades]. Plik w formacie .json ma rozmiar 231 MB.

W celu zaimportowania danych do bazy PostgreSQL wygodniej jest operowaæ plikiem w formacie json.
== Import danych

Importujemy do MongoDB pobrany plik trades.json, poleceniem:

[source]
mongoimport -d nosql -c trades trades.json

image::https://github.com/sportalski/nosql/EDAGEO/blob/master/images/mongoimport.jpg[]

Czas importu wyniós³ 37 sekund.

W celu zaimportowania danych do bazy PostgreSQL, tworzymy najpierw tabelê:

[source]
CREATE TABLE trades(
	id serial primary key,
	data json
);

Do importu wykorzystamy biblotekê psycopg2 oraz https://github.com/sportalski/nosql/EDAGEO/blob/master/insert.py[skrypt]. 
W jego wyniku otrzymamy

image::https://github.com/sportalski/nosql/EDAGEO/blob/master/images/postgresimport.jpg[]

Czas importu wyniós³ 3 minuty i 25 sekund

O to wykorzystanie podzespo³ów podczas importowania do Postgres
image::https://github.com/sportalski/nosql/EDAGEO/blob/master/images/monitor.jpg[]

== Zliczanie rekordów

W obu bazach zliczamy rekordy:

image::https://github.com/sportalski/nosql/EDAGEO/blob/master/images/mongopostCount.jpg[]


Zatem w obu przypadkach zaimportowaliœmy 1000001 rekordów.

== Agregacje
Obliczymy jakie bilety wystêpuj¹ najczêœciej a jakie najrzadziej. W tym celu wykorzystamy zapytanie:
[source]
SELECT data->>'ticket' as coste, COUNT(*) as Quantity FROM trades GROUP BY data->>'ticket' ORDER BY Quantity DESC LIMIT 100;

W wyniku niego otrzymujemy listê 100 najczêœciej wystêpuj¹cych biletów:

image::https://github.com/sportalski/nosql/EDAGEO/blob/master/images/bilety.jpg[]

Trochê dziwna ta baza :)

obliczmy jakie bilety wystêpuj¹ najrzadziej:
Jako, ¿e baza posiada milion rekordów a ka¿dy bilet wystêpujê po 2500 razy to limit ustawiony na 5.
[source]
db.trades.aggregate([{"$group" : {"_id" : "$ticket", "count" : {"$sum" : 1}}},
                                      {"$sort" : {"count" : 1}},
                                      {"$limit" : 5}])
                        
image::https://github.com/sportalski/nosql/EDAGEO/blob/master/images/bilety2.jpg[]

== Mapa GEOJSON
https://github.com/sportalski/nosql/EDAGEO/blob/master/mapa.geojson[MAPA]




